<Window x:Class="WpMyApp.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:WpMyApp.Converters"
        xmlns:controls="clr-namespace:WpMyApp.Controls"
        xmlns:vm="clr-namespace:WpMyApp.ViewModels"
        xmlns:models="clr-namespace:WpMyApp.Models"
        Title="Управление IT-Проектами - Дашборд" Height="900" Width="1400"
        WindowStartupLocation="CenterScreen"
        Background="#0F0F0F">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <converters:DeadlineColorConverter x:Key="DeadlineColorConverter"/>

        <!-- Стили -->
        <Style x:Key="CardBorder" TargetType="Border">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="14"/>
            <Setter Property="Margin" Value="10"/>
        </Style>

        <Style x:Key="HeaderText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>
        
        <Style x:Key="SmallText" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#CFCFCF"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="BorderBrush" Value="#555555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3D3D3D"/>
                    <Setter Property="BorderBrush" Value="#777777"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Стиль для элементов списка -->
        <Style x:Key="ListItemStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="8,12"/>
            <Setter Property="Background" Value="Transparent"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2A2A2A"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#111111" CornerRadius="8" Padding="15" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0">
                    <TextBlock Text="Управление IT-Проектами" Foreground="#FFFFFF" FontSize="24" FontWeight="Bold"/>
                    <TextBlock Text="{Binding CurrentMonth}" Foreground="#BBBBBB" FontSize="14"/>
                </StackPanel>

                <!-- Navigation -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button Content="🏠 Главная" Command="{Binding NavigateToHomeCommand}" Style="{StaticResource ModernButton}"/>
                    <Button Content="📊 Проекты" Command="{Binding NavigateToProjectsCommand}" Style="{StaticResource ModernButton}"/>
                    <Button Content="📈 Прогресс" Command="{Binding NavigateToProgressCommand}" Style="{StaticResource ModernButton}"/>
                    <Button Content="⏰ Дедлайны" Command="{Binding NavigateToDeadlinesCommand}" Style="{StaticResource ModernButton}"/>
                    <Button Content="⚙ Настройки" Command="{Binding NavigateToSettingsCommand}" Style="{StaticResource ModernButton}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="360"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Projects & Stats -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Recent Projects -->
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <TextBlock Text="Последние проекты" Style="{StaticResource HeaderText}"/>

                            <ItemsControl ItemsSource="{Binding RecentProjects}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource ListItemStyle}">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Name}" Foreground="#FFFFFF" FontSize="14" FontWeight="SemiBold"/>
                                                <TextBlock Text="{Binding Description}" Foreground="#AAAAAA" FontSize="11" 
                                                           TextTrimming="CharacterEllipsis" MaxHeight="32"/>
                                                <ProgressBar Value="{Binding Progress, Mode=OneWay}"  Maximum="100" Height="6" Margin="0,8,0,0"
                                                           Background="#333333" Foreground="#4CAF50"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                                    <Button Content="Открыть" Command="{Binding DataContext.OpenProjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding Id}" Style="{StaticResource ModernButton}" Padding="8,4" FontSize="11"/>
                                                    <Button Content="Удалить" Command="{Binding DataContext.DeleteProjectByIdCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding Id}" Style="{StaticResource ModernButton}" Padding="8,4" FontSize="11"
                                                            Background="#7C2C2C" BorderBrush="#A04545"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                                <Button Content="➕ Новый проект" Command="{Binding NewProjectCommand}" Style="{StaticResource ModernButton}"/>
                                <Button Content="🔄 Обновить" Command="{Binding RefreshDashboardCommand}" Style="{StaticResource ModernButton}"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Statistics -->
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <TextBlock Text="📊 Статистика" Style="{StaticResource HeaderText}"/>
                            <Grid Margin="0,10,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                                    <TextBlock Text="Проектов" Style="{StaticResource SmallText}"/>
                                    <TextBlock Text="{Binding TotalProjects}" Foreground="#4CAF50" FontSize="24" FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,0,10">
                                    <TextBlock Text="Задач" Style="{StaticResource SmallText}"/>
                                    <TextBlock Text="{Binding TotalTasksCount}" Foreground="#2196F3" FontSize="24" FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="0" Margin="0,10,10,10">
                                    <TextBlock Text="Выполнено" Style="{StaticResource SmallText}"/>
                                    <TextBlock Text="{Binding CompletedTasksCount}" Foreground="#FF9800" FontSize="24" FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Grid.Row="1" Grid.Column="1" Margin="10,10,0,10">
                                    <TextBlock Text="Просрочено" Style="{StaticResource SmallText}"/>
                                    <TextBlock Text="{Binding OverdueTasksCount}" Foreground="#F44336" FontSize="24" FontWeight="Bold"/>
                                </StackPanel>

                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,10,0,0">
                                    <TextBlock Text="Общий прогресс" Style="{StaticResource SmallText}"/>
                                    <ProgressBar Value="{Binding OverallProgress}" Maximum="100" Height="10" 
                                               Background="#333333" Foreground="#4CAF50"/>
                                    <TextBlock Text="{Binding OverallProgress, StringFormat={}{0:F1}%}" 
                                               Foreground="#FFFFFF" FontSize="12" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- CENTER: Calendar & Tasks -->
            <ScrollViewer Grid.Column="1" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Calendar -->
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel>
                            <TextBlock Text="📅 Календарь" Style="{StaticResource HeaderText}"/>
                            <Calendar SelectedDate="{Binding Today}" DisplayDate="{Binding Today}" 
                                    Background="Transparent" BorderBrush="#333333"/>
                        </StackPanel>
                    </Border>

                    <!-- Upcoming Deadlines -->
                    <Border Style="{StaticResource CardBorder}" Margin="0,10,0,0">
                        <StackPanel>
                            <TextBlock Text="⏰ Ближайшие дедлайны" Style="{StaticResource HeaderText}"/>

                            <ItemsControl ItemsSource="{Binding UpcomingDeadlines}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource ListItemStyle}" Margin="0,0,0,8">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Title}" Foreground="#FFFFFF" FontSize="13" FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding ProjectName}" Foreground="#888888" FontSize="11"/>
                                                    <TextBlock Text="{Binding Description}" Foreground="#666666" FontSize="10" 
                                                               TextTrimming="CharacterEllipsis" MaxHeight="20"/>
                                                </StackPanel>

                                                <StackPanel Grid.Column="1" HorizontalAlignment="Right">
                                                    <TextBlock Text="{Binding DueDate, StringFormat='dd.MM.yyyy'}" 
                                                               Foreground="#CCCCCC" FontSize="11"/>
                                                    <TextBlock Text="{Binding DaysLeftDisplay}" 
                                                               Foreground="{Binding DaysLeftColor}" FontSize="11" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>

                    <!-- Selected Project Tasks -->
                    <Border Style="{StaticResource CardBorder}" Margin="0,10,0,0">
                        <StackPanel>
                            <TextBlock Text="📋 Задачи проекта" Style="{StaticResource HeaderText}"/>
                            <TextBlock Text="{Binding SelectedProjectName}" Foreground="#AAAAAA" FontSize="12" Margin="0,0,0,10"/>

                            <ItemsControl ItemsSource="{Binding SelectedProjectTasks}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource ListItemStyle}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Title}" Foreground="#FFFFFF" FontSize="12"/>
                                                    <TextBlock Text="{Binding DueDate, StringFormat='До: {0:dd.MM.yyyy}'}" 
                                                               Foreground="#888888" FontSize="10"/>
                                                </StackPanel>

                                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                    <Button Content="✓" Command="{Binding DataContext.CompleteTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding Id}" Width="28" Height="28" Margin="2"
                                                            Background="#4CAF50" BorderBrush="#66BB6A" Foreground="White"
                                                            FontWeight="Bold" FontSize="12"/>
                                                    <Button Content="✎" Command="{Binding DataContext.EditTaskCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding Id}" Width="28" Height="28" Margin="2"
                                                            Background="#FF9800" BorderBrush="#FFB74D" Foreground="White"
                                                            FontWeight="Bold" FontSize="10"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>

            <!-- RIGHT: Progress & All Projects -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <!-- Progress -->
                    <Border Style="{StaticResource CardBorder}">
                        <StackPanel HorizontalAlignment="Center">
                            <TextBlock Text="📈 Прогресс проекта" Style="{StaticResource HeaderText}" HorizontalAlignment="Center"/>

                            <!-- Progress Circle (замените на ваш PieProgressControl если есть) -->
                            <Border Width="180" Height="180" Background="#2A2A2A" CornerRadius="90" 
                                    BorderBrush="#444444" BorderThickness="2" Margin="0,10,0,15">
                                <Viewbox>
                                    <TextBlock Text="{Binding SelectedProjectProgress, StringFormat={}{0:F1}%}" 
                                               Foreground="#4CAF50" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Viewbox>
                            </Border>

                            <TextBlock Text="{Binding SelectedProjectName}" Foreground="#FFFFFF" FontSize="16" 
                                       FontWeight="SemiBold" HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="280"/>
                            <TextBlock Text="{Binding SelectedProject.Description}" Foreground="#888888" FontSize="11" 
                                       HorizontalAlignment="Center" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" MaxHeight="40" MaxWidth="280"/>
                        </StackPanel>
                    </Border>

                    <!-- All Projects -->
                    <Border Style="{StaticResource CardBorder}" Margin="0,10,0,0" Width="342">
                        <StackPanel>
                            <TextBlock Text="📂 Все проекты" Style="{StaticResource HeaderText}"/>

                            <ItemsControl ItemsSource="{Binding Projects}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Style="{StaticResource ListItemStyle}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding Name}" Foreground="#FFFFFF" FontSize="12" FontWeight="SemiBold"/>
                                                    <TextBlock Text="{Binding Tasks.Count, StringFormat='Задач: {0}'}" 
                                                               Foreground="#888888" FontSize="10"/>
                                                </StackPanel>

                                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding Progress, StringFormat={}{0}%}" 
                                                               Foreground="#4CAF50" FontSize="11" FontWeight="Bold" Margin="0,0,10,0"/>
                                                    <Button Content="→" Command="{Binding DataContext.OpenProjectCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding Id}" Width="24" Height="24" 
                                                            Background="Transparent" BorderBrush="#666666" Foreground="#CCCCCC"
                                                            FontSize="10" FontWeight="Bold"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Background="#111111" Foreground="#CCCCCC" Padding="10,6">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" FontSize="12"/>
            </StatusBarItem>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>
            <StatusBarItem>
                <TextBlock Text="{Binding TotalProjects, StringFormat='Проектов: {0}'}" FontSize="11"/>
            </StatusBarItem>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>
            <StatusBarItem>
                <TextBlock Text="{Binding TotalTasksCount, StringFormat='Задач: {0}'}" FontSize="11"/>
            </StatusBarItem>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>
            <StatusBarItem>
                <TextBlock Text="{Binding CompletedTasksCount, StringFormat='Выполнено: {0}'}" Foreground="#4CAF50" FontSize="11"/>
            </StatusBarItem>
            <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"/>
            <StatusBarItem>
                <TextBlock Text="{Binding OverdueTasksCount, StringFormat='Просрочено: {0}'}" Foreground="#F44336" FontSize="11"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>